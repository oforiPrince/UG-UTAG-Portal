<!-- Add Gallery Modal -->
<div class="modal fade"
     id="addGalleryModal"
     tabindex="-1"
     aria-labelledby="addGalleryModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="addGalleryForm"
            method="post"
            enctype="multipart/form-data"
            action="{% url 'dashboard:gallery_add' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addGalleryModalLabel">Create Gallery</h5>
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="galleryTitle" class="form-label">Gallery Title</label>
            <input type="text"
                   class="form-control"
                   id="galleryTitle"
                   name="title"
                   maxlength="255"
                   required>
          </div>
          <div class="mb-3">
            <label for="galleryDescription" class="form-label">Description</label>
            <textarea class="form-control"
                      id="galleryDescription"
                      name="description"
                      rows="3"></textarea>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox"
                   class="form-check-input"
                   id="galleryIsActive"
                   name="is_active"
                   checked>
            <label class="form-check-label" for="galleryIsActive">Is Active</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save Gallery</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Upload Images Modal -->
<div class="modal fade"
     id="uploadImagesModal"
     tabindex="-1"
     aria-labelledby="uploadImagesModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="uploadImagesForm"
            class="dropzone"
            method="post"
            enctype="multipart/form-data"
            action="{% url 'dashboard:gallery_upload_images' %}">
        {% csrf_token %}
        <input type="hidden" name="gallery_id" id="gallery_id">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadImagesModalLabel">Upload Images to Gallery</h5>
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info mb-3">
            <i class="fa fa-info-circle"></i>
            <strong>Image Optimization:</strong> Images will be automatically optimized and thumbnails generated for faster loading.
            <br><small>Max file size: 10MB | Supported formats: JPEG, PNG, GIF, WebP</small>
          </div>
          <div class="mb-3">
            <label for="galleryImages" class="form-label">Upload Images (Drag & Drop or Click)</label>
            <div id="dropzone" class="dropzone"></div>
            <div id="uploadProgress" class="mt-3 d-none">
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                     role="progressbar" 
                     style="width: 0%"
                     aria-valuenow="0" 
                     aria-valuemin="0" 
                     aria-valuemax="100">0%</div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- View Gallery Details Modal -->
{% for gallery in galleries %}
  <div class="modal fade"
       id="galleryModal_{{ gallery.id }}"
       tabindex="-1"
       aria-labelledby="galleryModalLabel_{{ gallery.id }}"
       aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="galleryModalLabel_{{ gallery.id }}">Gallery Details â€” {{ gallery.title }}</h5>
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <strong>Description:</strong>
            <p>{{ gallery.description }}</p>
          </div>
          <div class="mb-3">
            <strong>Status:</strong>
            <p>{{ gallery.is_active|yesno:"Active,Inactive" }}</p>
          </div>
          <div class="mb-3">
            <strong>Created At:</strong>
            <p>{{ gallery.created_at|date:"d M Y" }}</p>
          </div>
          <div class="mb-3">
            <strong>Images:</strong>
            <div class="row g-3">
              {% for image in gallery.images.all|slice:":12" %}
                <div class="col-md-4 col-sm-6">
                  <div class="card shadow-sm">
                    <img src="{{ image.get_thumbnail_url }}"
                         class="card-img-top img-fluid rounded-top"
                         alt="{{ image.caption|default:'Gallery image' }}"
                         style="height: 200px; object-fit: cover;"
                         loading="lazy">
                    <div class="card-body p-2">
                      <p class="card-text small mb-1">{{ image.caption|default:"No Caption"|truncatewords:8 }}</p>
                      <p class="text-muted small mb-0">{{ image.uploaded_at|date:"d M Y" }}</p>
                    </div>
                  </div>
                </div>
              {% empty %}
                <div class="col-12">
                  <div class="text-center py-4">
                    <i class="fa fa-image fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No images available for this gallery.</p>
                  </div>
                </div>
              {% endfor %}
              {% if gallery.images.count > 12 %}
                <div class="col-12 text-center">
                  <p class="text-muted small">Showing 12 of {{ gallery.images.count }} images</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Edit Gallery Modal -->
  <div class="modal fade"
       id="editGalleryModal_{{ gallery.id }}"
       tabindex="-1"
       aria-labelledby="editGalleryModalLabel_{{ gallery.id }}"
       aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="editGalleryForm">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="editGalleryModalLabel_{{ gallery.id }}">Edit Gallery</h5>
            <button type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="gallery_id" id="editGalleryId">
            <div class="mb-3">
              <label for="editGalleryTitle" class="form-label">Title</label>
              <input type="text"
                     class="form-control"
                     id="editGalleryTitle"
                     name="title"
                     required>
            </div>
            <div class="mb-3">
              <label for="editGalleryDescription" class="form-label">Description</label>
              <textarea class="form-control"
                        id="editGalleryDescription"
                        name="description"
                        rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Images</label>
              <div id="galleryImages" class="row">
                <!-- Images will be loaded dynamically -->
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- View Gallery Modal -->
  <div class="modal fade"
       id="viewGalleryModal_{{ gallery.id }}"
       tabindex="-1"
       aria-labelledby="viewGalleryModalLabel_{{ gallery.id }}"
       aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewGalleryModalLabel_{{ gallery.id }}">Gallery Details</h5>
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h5 id="viewGalleryTitle"></h5>
          <p id="viewGalleryDescription"></p>
          <div id="viewGalleryImages" class="row g-3">
            <!-- Images will be loaded dynamically here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
{% endfor %}
