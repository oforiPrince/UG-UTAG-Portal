{% extends "base/dashboard_base.html" %}
{% load static %}
{% load image_tags %}
{% load name_filters %}

{% block title %}
    {{ news.title }} â€” News
{% endblock title %}

{% block content %}
    <div class="page-content">
        <div class="container-fluid">
            <!-- start page title -->
            <div class="page-title-box">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h6 class="page-title">News Detail</h6>
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item">
                                <a href="{% url 'dashboard:dashboard' %}">Dashboard</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'dashboard:news' %}">News</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">{{ news.title }}</li>
                        </ol>
                    </div>
                    <div class="col-md-4">
                        <div class="float-end d-none d-md-block">
                            {% if user.is_admin or user.is_active_executive %}
                                <a href="{% url 'dashboard:update_news' news.id %}" class="btn btn-success btn-sm me-2">
                                    <i class="mdi mdi-pen"></i> Edit
                                </a>
                            {% endif %}
                            <a href="{% url 'dashboard:news' %}" class="btn btn-secondary btn-sm">
                                <i class="mdi mdi-arrow-left"></i> Back
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->

            <!-- News Detail Card -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <!-- Featured Image -->
                            {% if news.featured_image %}
                                <div class="mb-4">
                                    {% lazy_img news.featured_image.url news.title "img-fluid rounded shadow" "news" %}
                                </div>
                            {% endif %}

                            <!-- Title -->
                            <h2 class="mb-3">{{ news.title }}</h2>

                            <!-- Meta Information -->
                            <div class="row mb-4 pb-4 border-bottom">
                                <div class="col-md-6">
                                    <p class="mb-2">
                                        <strong>Author:</strong>
                                        <span>{{ news.author|format_full_name }}</span>
                                    </p>
                                    <p class="mb-2">
                                        <strong>Created:</strong>
                                        <span>{{ news.created_at|date:"F d, Y \a\t h:i A" }}</span>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-2">
                                        <strong>Last Updated:</strong>
                                        <span>{{ news.updated_at|date:"F d, Y \a\t h:i A" }}</span>
                                    </p>
                                    <p class="mb-2">
                                        <strong>Status:</strong>
                                        {% if news.is_published and not news.is_pass_due %}
                                            <span class="badge bg-success">Published</span>
                                        {% else %}
                                            <span class="badge bg-warning">Draft</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            <!-- Tags -->
                            {% if news.tags.exists %}
                                <div class="mb-4">
                                    <p class="mb-2"><strong>Tags:</strong></p>
                                    <div>
                                        {% for tag in news.tags.all %}
                                            <span class="badge bg-primary">{{ tag.name }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}

                            <!-- Main Content -->
                            <div class="mb-4 pt-3">
                                <h5 class="mb-3">Content</h5>
                                <div class="news-content" style="line-height: 1.8; color: #333;">
                                    {{ news.content|safe }}
                                </div>
                            </div>

                            <!-- Attachments Section -->
                            {% if news.attached_documents.exists %}
                                <div class="mb-4 pt-3 border-top">
                                    <h5 class="mb-3">
                                        <i class="mdi mdi-file"></i> Attachments
                                    </h5>
                                    <div class="list-group">
                                        {% for document in news.attached_documents.all %}
                                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <i class="mdi mdi-file-document"></i>
                                                    <strong>{{ document.name }}</strong>
                                                </div>
                                                <a href="{{ document.file.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                                    <i class="mdi mdi-download"></i> Download
                                                </a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}

                            <!-- Citations Section -->
                            {% if news.citations.exists %}
                                <div class="pt-3 border-top">
                                    <h5 class="mb-3">
                                        <i class="mdi mdi-book"></i> Citations & References
                                    </h5>
                                    <ol class="ps-4" style="line-height: 1.8;">
                                        {% for citation in news.citations.all %}
                                            <li class="mb-3">
                                                <strong>{{ citation.source_name }}</strong>
                                                {% if citation.description %}
                                                    <p class="mb-1 text-muted">{{ citation.description }}</p>
                                                {% endif %}
                                                {% if citation.url %}
                                                    <a href="{{ citation.url }}" target="_blank" rel="noopener" class="btn btn-sm btn-link">
                                                        <i class="mdi mdi-open-in-new"></i> View Source
                                                    </a>
                                                {% endif %}
                                            </li>
                                        {% endfor %}
                                    </ol>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Back Button (Mobile) -->
            <div class="row mt-4">
                <div class="col-12">
                    <a href="{% url 'dashboard:news' %}" class="btn btn-secondary d-md-none w-100">
                        <i class="mdi mdi-arrow-left"></i> Back to News
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block my_styles %}
    <!-- Custom styles for better news presentation -->
    <style>
        .news-content {
            font-size: 16px;
            word-wrap: break-word;
        }

        .news-content img {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border-radius: 4px;
        }

        .news-content p {
            margin-bottom: 1rem;
        }

        .news-content h1, .news-content h2, .news-content h3, .news-content h4, .news-content h5, .news-content h6 {
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .news-content ul, .news-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .news-content li {
            margin-bottom: 0.5rem;
        }

        .news-content blockquote {
            border-left: 4px solid #002147;
            padding-left: 15px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }

        .news-content code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .news-content pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .list-group-item {
            border: 1px solid #dee2e6;
            padding: 15px;
        }

        .list-group-item:hover {
            background-color: #f9f9f9;
        }

        .badge {
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
            margin-right: 5px;
        }
    </style>
{% endblock my_styles %}
