{% extends "base/base-v2.html" %}
{% load static %}
{% load image_tags %}
{% block title %}Gallery{% endblock title %}
{% block content %}
<!--Breadcrumb Banner Area Start-->
<div class="breadcrumb-banner-area gallery">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="breadcrumb-text">
          <h1 class="text-center">Gallery</h1>
          <div class="breadcrumb-bar">
            <ul class="breadcrumb">
              <li><a href="{% url 'website:index' %}">Home</a></li>
              <li>Gallery</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End of Breadcrumb Banner Area-->
<!--Gallery Area Start-->
<div class="gallery-area section-padding gallery-full-width">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="filter-menu">
          <ul>
            <li class="filter active" data-filter="all">All</li>
            {% if galleries %}
              {% for gallery in galleries %}
                <li class="filter" data-filter=".gallery-{{ gallery.id }}">{{ gallery.title }}</li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    <div class="filter-items">
      <div class="row mix-grid">
        {% if galleries %}
          {% for gallery in galleries %}
            {% for image in gallery.images.all %}
              <div class="single-items col-lg-3 col-md-3 col-sm-6 col-12 overlay-hover mix gallery-{{ gallery.id }}">
                <div class="overlay-effect sea-green-overlay">
                  <a href="{{ image.get_absolute_url }}"
                     data-gallery="gallery-{{ gallery.id }}"
                     data-caption="{{ image.caption|default:gallery.title }}">
                    {% lazy_img image.image.url image.caption|default:gallery.title "gallery-image img-fluid" "gallery" %}
                  </a>
                  <div class="gallery-hover-effect">
                    <a class="gallery-icon venobox"
                       href="{{ image.get_absolute_url }}"
                       data-gallery="gallery-{{ gallery.id }}"
                       data-caption="{{ image.caption|default:gallery.title }}">
                      <i class="fa fa-image"></i>
                    </a>
                    {% if image.caption %}
                      <span class="gallery-text">{{ image.caption }}</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endfor %}
        {% else %}
          <div class="col-12">
            <div class="text-center py-5">
              <i class="fa fa-image fa-3x text-muted mb-3"></i>
              <p class="text-muted">No galleries are currently available. Please check back later.</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<!--End of Gallery Area-->
{% endblock content %}

{% block extra_head %}
  <style>
    /* Gallery Performance Optimizations */
    .gallery-image {
      transition: transform 0.3s ease, opacity 0.3s ease;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
    }
    
    .gallery-image.loaded {
      background: none;
      opacity: 1;
    }
    
    .single-items {
      margin-bottom: 20px;
    }
    
    .overlay-effect {
      position: relative;
      overflow: hidden;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }
    
    .overlay-effect:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .gallery-hover-effect {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .overlay-effect:hover .gallery-hover-effect {
      opacity: 1;
    }
    
    .gallery-text {
      color: white;
      margin-top: 10px;
      text-align: center;
      padding: 0 15px;
    }
  </style>
{% endblock extra_head %}
{% block extra_js %}
<script>
  $(document).ready(function(){
    // Initialize MixItUp for filtering
    if ($('.mix-grid').length && typeof $.fn.mixItUp !== 'undefined') {
      $('.mix-grid').mixItUp({
        selectors: {
          target: '.mix',
          filter: '.filter'
        },
        animation: {
          duration: 300
        }
      });
    }
    
    // Lazy load full-size images when thumbnail is clicked
    $('.gallery-image').on('click', function() {
      var $img = $(this);
      var fullSrc = $img.data('src');
      if (fullSrc && !$img.hasClass('loaded-full')) {
        var tempImg = new Image();
        tempImg.onload = function() {
          $img.attr('src', fullSrc).addClass('loaded-full');
        };
        tempImg.src = fullSrc;
      }
    });
    
    // Progressive image loading with Intersection Observer
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.classList.add('loaded');
            imageObserver.unobserve(img);
          }
        });
      }, {
        threshold: 0.1
      });
      
      document.querySelectorAll('.gallery-image').forEach(function(img) {
        imageObserver.observe(img);
      });
    } else {
      // Fallback for older browsers
      document.querySelectorAll('.gallery-image').forEach(function(img) {
        img.classList.add('loaded');
      });
    }
  });
</script>
{% endblock %}