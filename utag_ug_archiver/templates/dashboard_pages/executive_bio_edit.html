{% extends "base/dashboard_base.html" %}
{% load static %}

{% block title %}Edit Executive Bio{% endblock %}

{% block extra_css %}
<style>
  .form-control:not(.tox-tinymce) {
    border-radius: 0.375rem;
  }
  .form-label {
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
  }
  .form-text {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.25rem;
  }
  .card-header {
    border-bottom: 2px solid #e9ecef;
  }
  .card-header h5 {
    font-weight: 700;
    letter-spacing: 0.5px;
  }
  .profile-preview {
    text-align: center;
    padding: 1.5rem;
  }
  .profile-pic-circle {
    width: 160px;
    height: 160px;
    margin: 0 auto 1rem;
    object-fit: cover;
  }
  .tips-box {
    background: #f8f9fa;
    border-left: 4px solid #0d6efd;
    padding: 1rem;
  }
  .tips-box ul {
    margin-bottom: 0;
  }
  .tips-box li {
    margin-bottom: 0.5rem;
    color: #666;
  }
  /* TinyMCE styling */
  .tox-tinymce {
    border-radius: 0.375rem !important;
    border: 1px solid #dee2e6 !important;
  }
  .tox-tinymce:focus-within {
    border-color: #0d6efd !important;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25) !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Professional Bio Editor</h5>
          <small class="text-light">Craft a compelling executive profile</small>
        </div>
        <div class="card-body">
          <form method="post" enctype="multipart/form-data" class="needs-validation">
            {% csrf_token %}
            
            <!-- Title -->
            <div class="mb-3">
              <label for="{{ form.title.id_for_label }}" class="form-label">Title *</label>
              {{ form.title }}
              {% if form.title.errors %}
                <div class="invalid-feedback d-block">{{ form.title.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Academic Rank -->
            <div class="mb-3">
              <label for="{{ form.academic_rank.id_for_label }}" class="form-label">Academic Rank</label>
              {{ form.academic_rank }}
              <div class="form-text">e.g., Senior Lecturer, Associate Professor, etc.</div>
              {% if form.academic_rank.errors %}
                <div class="invalid-feedback d-block">{{ form.academic_rank.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Profile Picture -->
            <div class="mb-3">
              <label for="{{ form.profile_pic.id_for_label }}" class="form-label">Profile Picture</label>
              {% if form.instance.profile_pic %}
                <div class="mb-2">
                  <img src="{{ form.instance.profile_pic.url }}" alt="Current Profile" style="max-width: 120px; border-radius: 0.375rem;">
                </div>
              {% endif %}
              {{ form.profile_pic }}
              <div class="form-text">Upload a professional headshot (JPG, PNG)</div>
              {% if form.profile_pic.errors %}
                <div class="invalid-feedback d-block">{{ form.profile_pic.errors.0 }}</div>
              {% endif %}
            </div>

            <hr class="my-4">

            <!-- Executive Summary -->
            <div class="mb-3">
              <label for="{{ form.executive_summary.id_for_label }}" class="form-label">Executive Summary</label>
              {{ form.executive_summary }}
              <div class="form-text">A concise tagline or professional summary (300 characters max)</div>
              {% if form.executive_summary.errors %}
                <div class="invalid-feedback d-block">{{ form.executive_summary.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Full Bio with TinyMCE -->
            <div class="mb-3">
              <label for="{{ form.executive_bio.id_for_label }}" class="form-label">Full Professional Bio *</label>
              {{ form.executive_bio }}
              <div class="form-text">
                Include roles, achievements, publications, leadership contributions, and vision. 
                Use the rich text editor below for formatting.
              </div>
              {% if form.executive_bio.errors %}
                <div class="invalid-feedback d-block">{{ form.executive_bio.errors.0 }}</div>
              {% endif %}
            </div>

            <hr class="my-4">

            <!-- Social Links -->
            <h6 class="mb-3">Connect</h6>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="{{ form.linkedin_url.id_for_label }}" class="form-label">LinkedIn</label>
                {{ form.linkedin_url }}
                {% if form.linkedin_url.errors %}
                  <div class="invalid-feedback d-block">{{ form.linkedin_url.errors.0 }}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.twitter_url.id_for_label }}" class="form-label">Twitter/X</label>
                {{ form.twitter_url }}
                {% if form.twitter_url.errors %}
                  <div class="invalid-feedback d-block">{{ form.twitter_url.errors.0 }}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.personal_website_url.id_for_label }}" class="form-label">Personal Website</label>
                {{ form.personal_website_url }}
                {% if form.personal_website_url.errors %}
                  <div class="invalid-feedback d-block">{{ form.personal_website_url.errors.0 }}</div>
                {% endif %}
              </div>
            </div>

            <hr class="my-4">

            <!-- Submit Button -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i> Save Professional Bio
              </button>
              <a href="{% url 'dashboard:dashboard' %}" class="btn btn-secondary btn-lg">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Profile Preview Sidebar -->
    <div class="col-lg-4">
      <!-- Current Profile Preview -->
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-light">
          <h6 class="mb-0">Profile Preview</h6>
        </div>
        <div class="profile-preview">
          {% if target.profile_pic %}
            <img src="{{ target.profile_pic.url }}" alt="Profile" class="img-fluid rounded-circle profile-pic-circle" style="border: 3px solid #e9ecef;">
          {% else %}
            <div class="rounded-circle bg-light d-inline-block mb-3" style="width:160px;height:160px;display:flex;align-items:center;justify-content:center;font-size:48px;color:#999;">
              {{ target.surname|slice:":1"|upper }}
            </div>
          {% endif %}
          <h5 class="mb-1 fw-bold">{{ target.surname }} {{ target.other_name }}</h5>
          <div class="text-muted small">{{ target.title }}{% if target.academic_rank %} â€¢ {{ target.academic_rank }}{% endif %}</div>
          {% if target.executive_summary %}
            <div class="mt-3 small text-dark" style="line-height: 1.5;">
              <em>{{ target.executive_summary }}</em>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Tips Card -->
      <div class="card shadow-sm tips-box">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="fas fa-lightbulb text-warning"></i> Tips for Professional Bios
          </h6>
        </div>
        <div class="card-body">
          <ul>
            <li><strong>Use professional photos:</strong> High-quality headshots make a great impression.</li>
            <li><strong>Lead with impact:</strong> Start with your key achievement or role.</li>
            <li><strong>Keep it concise:</strong> 150-200 words is ideal for most profiles.</li>
            <li><strong>Highlight leadership:</strong> Include board positions and major initiatives.</li>
            <li><strong>Add credentials:</strong> Link to publications, projects, and achievements.</li>
            <li><strong>End with vision:</strong> Share what you're passionate about moving forward.</li>
            <li><strong>Use rich formatting:</strong> Bold key roles and achievements for emphasis.</li>
          </ul>
        </div>
      </div>

      <!-- Social Links Preview -->
      {% if target.linkedin_url or target.twitter_url or target.personal_website_url %}
        <div class="card shadow-sm mt-3">
          <div class="card-header bg-light">
            <h6 class="mb-0">Social Links</h6>
          </div>
          <div class="card-body">
            {% if target.linkedin_url %}
              <a href="{{ target.linkedin_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary mb-2 w-100">
                <i class="fab fa-linkedin"></i> LinkedIn Profile
              </a>
            {% endif %}
            {% if target.twitter_url %}
              <a href="{{ target.twitter_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-info mb-2 w-100">
                <i class="fab fa-twitter"></i> Twitter/X Profile
              </a>
            {% endif %}
            {% if target.personal_website_url %}
              <a href="{{ target.personal_website_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-secondary w-100">
                <i class="fas fa-globe"></i> Personal Website
              </a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Load TinyMCE JS -->
{{ form.media }}
